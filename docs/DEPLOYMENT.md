# VibePipe MVP Deployment Guide\n\n> Complete guide for deploying VibePipe MVP to production environments\n\n## Table of Contents\n\n- [Overview](#overview)\n- [Prerequisites](#prerequisites)\n- [Environment Configuration](#environment-configuration)\n- [Build Process](#build-process)\n- [Deployment Options](#deployment-options)\n- [Vercel Deployment](#vercel-deployment)\n- [Docker Deployment](#docker-deployment)\n- [Self-Hosted Deployment](#self-hosted-deployment)\n- [Environment Variables](#environment-variables)\n- [Performance Optimization](#performance-optimization)\n- [Monitoring and Logging](#monitoring-and-logging)\n- [Security Considerations](#security-considerations)\n- [Troubleshooting](#troubleshooting)\n\n## Overview\n\nVibePipe MVP is designed to be deployed as a modern web application with the following characteristics:\n\n- **Static Generation**: Most pages are statically generated for optimal performance\n- **API Routes**: Server-side functionality through Next.js API routes\n- **Client-Side Storage**: All user data stored locally in browser\n- **Privacy-First**: No server-side user data storage required\n- **Scalable**: Designed to handle high traffic with proper caching\n\n## Prerequisites\n\n### System Requirements\n\n- **Node.js**: Version 18.0 or higher\n- **npm**: Version 9.0 or higher (or yarn 1.22+)\n- **Python**: Version 3.7+ (for yt-dlp)\n- **Memory**: Minimum 2GB RAM for build process\n- **Storage**: At least 1GB free space for dependencies and build\n\n### Automatic yt-dlp Setup\n\nVibePipe MVP includes automatic yt-dlp installation and configuration:\n\n```bash\n# Automatic setup during npm install\nnpm install  # This will automatically install yt-dlp\n\n# Or run setup manually\nnpm run setup\n```\n\nThe setup script will:\n- ✅ Detect your operating system\n- ✅ Install yt-dlp using the best available method (pip, brew, winget)\n- ✅ Create integration wrappers\n- ✅ Configure Docker and deployment files\n- ✅ Verify installation\n\n### Development Tools\n\n- **Git**: For version control\n- **Docker**: For containerized deployment (optional)\n- **PM2**: For process management (self-hosted)\n\n## Environment Configuration\n\n### 1. Environment Files\n\nCreate environment-specific configuration files:\n\n```bash\n# Copy example environment file\ncp .env.example .env.local\n\n# Edit with your configuration\nnano .env.local\n```\n\n### 2. Production Environment Variables\n\n```bash\n# Production Configuration\nNODE_ENV=production\nNEXT_PUBLIC_APP_ENV=production\nNEXT_PUBLIC_API_BASE_URL=https://your-domain.com/api\n\n# Disable development features\nNEXT_PUBLIC_ENABLE_DEBUG=false\nNEXT_PUBLIC_ENABLE_PERFORMANCE_MONITORING=true\nNEXT_PUBLIC_ENABLE_ANALYTICS=true\n\n# Security settings\nNEXT_PUBLIC_PRIVACY_MODE=strict\n\n# Performance optimization\nNEXT_PUBLIC_CACHE_DURATION=600000\n```\n\n## Build Process\n\n### 1. Pre-build Checks\n\n```bash\n# Install dependencies\nnpm ci\n\n# Run type checking\nnpm run type-check\n\n# Run linting\nnpm run lint\n\n# Run tests\nnpm run test\n```\n\n### 2. Production Build\n\n```bash\n# Standard production build\nnpm run build\n\n# Build with bundle analysis\nnpm run build:analyze\n\n# Build standalone version\nnpm run build:standalone\n```\n\n### 3. Build Verification\n\n```bash\n# Start production server locally\nnpm start\n\n# Run E2E tests against production build\nnpm run test:e2e\n```\n\n## Deployment Options\n\n### Comparison Matrix\n\n| Platform | Complexity | Cost | Performance | Scalability | Maintenance |\n|----------|------------|------|-------------|-------------|-------------|\n| **Vercel** | Low | Free/Paid | Excellent | Auto | Minimal |\n| **Netlify** | Low | Free/Paid | Good | Auto | Minimal |\n| **Docker** | Medium | Variable | Good | Manual | Medium |\n| **Self-Hosted** | High | Low | Variable | Manual | High |\n\n## Vercel Deployment\n\n### 1. Automatic Deployment\n\n```bash\n# Install Vercel CLI\nnpm install -g vercel\n\n# Login to Vercel\nvercel login\n\n# Deploy\nvercel\n```\n\n### 2. GitHub Integration\n\n1. **Connect Repository**:\n   - Go to [Vercel Dashboard](https://vercel.com/dashboard)\n   - Click \"New Project\"\n   - Import your GitHub repository\n\n2. **Configure Build Settings**:\n   ```\n   Framework Preset: Next.js\n   Build Command: npm run build\n   Output Directory: .next\n   Install Command: npm ci\n   ```\n\n3. **Environment Variables**:\n   ```\n   NODE_ENV=production\n   NEXT_PUBLIC_APP_ENV=production\n   NEXT_PUBLIC_API_BASE_URL=https://your-app.vercel.app/api\n   ```\n\n### 3. Custom Domain\n\n```bash\n# Add custom domain\nvercel domains add your-domain.com\n\n# Configure DNS\n# Add CNAME record: your-domain.com -> cname.vercel-dns.com\n```\n\n### 4. Vercel Configuration\n\nCreate `vercel.json`:\n\n```json\n{\n  \"version\": 2,\n  \"builds\": [\n    {\n      \"src\": \"package.json\",\n      \"use\": \"@vercel/next\"\n    }\n  ],\n  \"headers\": [\n    {\n      \"source\": \"/(.*)\",\n      \"headers\": [\n        {\n          \"key\": \"X-Frame-Options\",\n          \"value\": \"DENY\"\n        },\n        {\n          \"key\": \"X-Content-Type-Options\",\n          \"value\": \"nosniff\"\n        },\n        {\n          \"key\": \"Cache-Control\",\n          \"value\": \"public, max-age=31536000, immutable\"\n        }\n      ]\n    }\n  ],\n  \"rewrites\": [\n    {\n      \"source\": \"/api/(.*)\",\n      \"destination\": \"/api/$1\"\n    }\n  ]\n}\n```\n\n## Docker Deployment\n\n### 1. Dockerfile\n\nCreate `Dockerfile`:\n\n```dockerfile\n# Multi-stage build for optimal image size\nFROM node:18-alpine AS base\n\n# Install dependencies only when needed\nFROM base AS deps\nRUN apk add --no-cache libc6-compat\nWORKDIR /app\n\n# Install dependencies based on the preferred package manager\nCOPY package.json package-lock.json* ./\nRUN npm ci --only=production\n\n# Rebuild the source code only when needed\nFROM base AS builder\nWORKDIR /app\nCOPY --from=deps /app/node_modules ./node_modules\nCOPY . .\n\n# Environment variables for build\nENV NODE_ENV=production\nENV NEXT_PUBLIC_APP_ENV=production\n\n# Build application\nRUN npm run build\n\n# Production image, copy all the files and run next\nFROM base AS runner\nWORKDIR /app\n\nENV NODE_ENV=production\n\n# Create non-root user\nRUN addgroup --system --gid 1001 nodejs\nRUN adduser --system --uid 1001 nextjs\n\n# Copy built application\nCOPY --from=builder /app/public ./public\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static\n\nUSER nextjs\n\nEXPOSE 3000\n\nENV PORT=3000\nENV HOSTNAME=\"0.0.0.0\"\n\nCMD [\"node\", \"server.js\"]\n```\n\n### 2. Docker Compose\n\nCreate `docker-compose.yml`:\n\n```yaml\nversion: '3.8'\n\nservices:\n  vibepipe:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NODE_ENV=production\n      - NEXT_PUBLIC_APP_ENV=production\n      - NEXT_PUBLIC_API_BASE_URL=http://localhost:3000/api\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:3000/api/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n\n  nginx:\n    image: nginx:alpine\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    volumes:\n      - ./nginx.conf:/etc/nginx/nginx.conf:ro\n      - ./ssl:/etc/nginx/ssl:ro\n    depends_on:\n      - vibepipe\n    restart: unless-stopped\n```\n\n### 3. Build and Deploy\n\n```bash\n# Build Docker image\ndocker build -t vibepipe-mvp .\n\n# Run with Docker Compose\ndocker-compose up -d\n\n# Check logs\ndocker-compose logs -f vibepipe\n```\n\n## Self-Hosted Deployment\n\n### 1. Server Setup\n\n```bash\n# Update system\nsudo apt update && sudo apt upgrade -y\n\n# Install Node.js\ncurl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -\nsudo apt-get install -y nodejs\n\n# Install PM2\nnpm install -g pm2\n\n# Install Nginx\nsudo apt install nginx -y\n```\n\n### 2. Application Deployment\n\n```bash\n# Clone repository\ngit clone <your-repo-url> /var/www/vibepipe\ncd /var/www/vibepipe\n\n# Install dependencies\nnpm ci --only=production\n\n# Build application\nnpm run build\n\n# Create PM2 ecosystem file\ncat > ecosystem.config.js << EOF\nmodule.exports = {\n  apps: [{\n    name: 'vibepipe-mvp',\n    script: 'npm',\n    args: 'start',\n    cwd: '/var/www/vibepipe',\n    instances: 'max',\n    exec_mode: 'cluster',\n    env: {\n      NODE_ENV: 'production',\n      PORT: 3000\n    },\n    error_file: '/var/log/pm2/vibepipe-error.log',\n    out_file: '/var/log/pm2/vibepipe-out.log',\n    log_file: '/var/log/pm2/vibepipe.log'\n  }]\n};\nEOF\n\n# Start with PM2\npm2 start ecosystem.config.js\npm2 save\npm2 startup\n```\n\n### 3. Nginx Configuration\n\nCreate `/etc/nginx/sites-available/vibepipe`:\n\n```nginx\nserver {\n    listen 80;\n    server_name your-domain.com www.your-domain.com;\n    return 301 https://$server_name$request_uri;\n}\n\nserver {\n    listen 443 ssl http2;\n    server_name your-domain.com www.your-domain.com;\n\n    # SSL Configuration\n    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;\n    ssl_prefer_server_ciphers off;\n    ssl_session_cache shared:SSL:10m;\n    ssl_session_timeout 10m;\n\n    # Security Headers\n    add_header X-Frame-Options DENY;\n    add_header X-Content-Type-Options nosniff;\n    add_header X-XSS-Protection \"1; mode=block\";\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n    add_header Referrer-Policy \"origin-when-cross-origin\";\n\n    # Gzip Compression\n    gzip on;\n    gzip_vary on;\n    gzip_min_length 1024;\n    gzip_proxied expired no-cache no-store private must-revalidate auth;\n    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;\n\n    # Static Assets\n    location /_next/static/ {\n        alias /var/www/vibepipe/.next/static/;\n        expires 1y;\n        add_header Cache-Control \"public, immutable\";\n    }\n\n    location /static/ {\n        alias /var/www/vibepipe/public/;\n        expires 1y;\n        add_header Cache-Control \"public, immutable\";\n    }\n\n    # Proxy to Next.js\n    location / {\n        proxy_pass http://localhost:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n        proxy_read_timeout 86400;\n    }\n}\n```\n\nEnable the site:\n\n```bash\nsudo ln -s /etc/nginx/sites-available/vibepipe /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl reload nginx\n```\n\n### 4. SSL Certificate\n\n```bash\n# Install Certbot\nsudo apt install certbot python3-certbot-nginx -y\n\n# Get SSL certificate\nsudo certbot --nginx -d your-domain.com -d www.your-domain.com\n\n# Auto-renewal\nsudo crontab -e\n# Add: 0 12 * * * /usr/bin/certbot renew --quiet\n```\n\n## Environment Variables\n\n### Production Variables\n\n| Variable | Required | Description | Example |\n|----------|----------|-------------|----------|\n| `NODE_ENV` | Yes | Environment mode | `production` |\n| `NEXT_PUBLIC_APP_ENV` | Yes | App environment | `production` |\n| `NEXT_PUBLIC_API_BASE_URL` | Yes | API base URL | `https://app.com/api` |\n| `YOUTUBE_API_KEY` | No | YouTube API key | `AIza...` |\n| `OPENAI_API_KEY` | No | OpenAI API key | `sk-...` |\n\n### Security Variables\n\n| Variable | Default | Description |\n|----------|---------|-------------|\n| `NEXT_PUBLIC_PRIVACY_MODE` | `strict` | Privacy enforcement level |\n| `NEXT_PUBLIC_DATA_RETENTION_DAYS` | `30` | Data retention period |\n| `NEXT_PUBLIC_ENABLE_DEBUG` | `false` | Debug mode (production) |\n\n## Performance Optimization\n\n### 1. Build Optimization\n\n```bash\n# Analyze bundle size\nnpm run build:analyze\n\n# Check for unused dependencies\nnpx depcheck\n\n# Optimize images\nnpx next-optimized-images\n```\n\n### 2. Caching Strategy\n\n```javascript\n// next.config.ts\nconst nextConfig = {\n  async headers() {\n    return [\n      {\n        source: '/_next/static/(.*)',\n        headers: [\n          {\n            key: 'Cache-Control',\n            value: 'public, max-age=31536000, immutable',\n          },\n        ],\n      },\n      {\n        source: '/api/(.*)',\n        headers: [\n          {\n            key: 'Cache-Control',\n            value: 'public, max-age=300, s-maxage=600',\n          },\n        ],\n      },\n    ];\n  },\n};\n```\n\n### 3. CDN Configuration\n\n```javascript\n// For Cloudflare or similar CDN\nconst cdnConfig = {\n  images: {\n    domains: ['your-cdn-domain.com'],\n    loader: 'cloudflare',\n    path: 'https://your-cdn-domain.com/cdn-cgi/image/',\n  },\n};\n```\n\n## Monitoring and Logging\n\n### 1. Health Check Endpoint\n\nCreate `src/app/api/health/route.ts`:\n\n```typescript\nimport { NextResponse } from 'next/server';\n\nexport async function GET() {\n  const health = {\n    status: 'healthy',\n    timestamp: new Date().toISOString(),\n    version: process.env.NEXT_PUBLIC_APP_VERSION || '1.0.0',\n    uptime: process.uptime(),\n    memory: process.memoryUsage(),\n    environment: process.env.NODE_ENV,\n  };\n\n  return NextResponse.json(health);\n}\n```\n\n### 2. Logging Configuration\n\n```javascript\n// lib/logger.ts\nconst logger = {\n  info: (message: string, meta?: any) => {\n    if (process.env.NODE_ENV === 'production') {\n      console.log(JSON.stringify({ level: 'info', message, meta, timestamp: new Date().toISOString() }));\n    } else {\n      console.log(`[INFO] ${message}`, meta);\n    }\n  },\n  error: (message: string, error?: Error) => {\n    if (process.env.NODE_ENV === 'production') {\n      console.error(JSON.stringify({ level: 'error', message, error: error?.stack, timestamp: new Date().toISOString() }));\n    } else {\n      console.error(`[ERROR] ${message}`, error);\n    }\n  },\n};\n```\n\n### 3. Monitoring Setup\n\n```bash\n# Install monitoring tools\nnpm install --save-dev @vercel/analytics\n\n# For self-hosted: Install monitoring\nsudo apt install prometheus node-exporter grafana\n```\n\n## Security Considerations\n\n### 1. Security Headers\n\nImplemented in `next.config.ts`:\n\n```typescript\nconst securityHeaders = [\n  {\n    key: 'X-DNS-Prefetch-Control',\n    value: 'on'\n  },\n  {\n    key: 'Strict-Transport-Security',\n    value: 'max-age=63072000; includeSubDomains; preload'\n  },\n  {\n    key: 'X-XSS-Protection',\n    value: '1; mode=block'\n  },\n  {\n    key: 'X-Frame-Options',\n    value: 'DENY'\n  },\n  {\n    key: 'X-Content-Type-Options',\n    value: 'nosniff'\n  },\n  {\n    key: 'Referrer-Policy',\n    value: 'origin-when-cross-origin'\n  }\n];\n```\n\n### 2. Content Security Policy\n\n```typescript\nconst ContentSecurityPolicy = `\n  default-src 'self';\n  script-src 'self' 'unsafe-eval' 'unsafe-inline';\n  child-src 'none';\n  style-src 'self' 'unsafe-inline';\n  img-src 'self' blob: data: https:;\n  media-src 'self' https:;\n  connect-src 'self' https:;\n  font-src 'self';\n`;\n```\n\n### 3. Rate Limiting\n\n```typescript\n// lib/rateLimiter.ts\nimport { NextRequest } from 'next/server';\n\nconst rateLimiter = new Map();\n\nexport function rateLimit(request: NextRequest, limit = 100, window = 60000) {\n  const ip = request.ip || 'anonymous';\n  const now = Date.now();\n  const windowStart = now - window;\n  \n  const requests = rateLimiter.get(ip) || [];\n  const validRequests = requests.filter((time: number) => time > windowStart);\n  \n  if (validRequests.length >= limit) {\n    return false;\n  }\n  \n  validRequests.push(now);\n  rateLimiter.set(ip, validRequests);\n  return true;\n}\n```\n\n## Troubleshooting\n\n### Common Issues\n\n#### 1. Build Failures\n\n```bash\n# Clear cache and rebuild\nnpm run clean\nnpm ci\nnpm run build\n\n# Check for TypeScript errors\nnpm run type-check\n\n# Check for linting issues\nnpm run lint\n```\n\n#### 2. Memory Issues\n\n```bash\n# Increase Node.js memory limit\nexport NODE_OPTIONS=\"--max-old-space-size=4096\"\nnpm run build\n\n# For PM2\npm2 start ecosystem.config.js --node-args=\"--max-old-space-size=4096\"\n```\n\n#### 3. Performance Issues\n\n```bash\n# Analyze bundle\nnpm run build:analyze\n\n# Check for memory leaks\nnode --inspect npm run start\n\n# Monitor with PM2\npm2 monit\n```\n\n#### 4. SSL Issues\n\n```bash\n# Check certificate\nsudo certbot certificates\n\n# Renew certificate\nsudo certbot renew --dry-run\n\n# Check Nginx configuration\nsudo nginx -t\n```\n\n### Debugging Commands\n\n```bash\n# Check application logs\npm2 logs vibepipe-mvp\n\n# Check system resources\nhtop\ndf -h\nfree -m\n\n# Check network connectivity\ncurl -I https://your-domain.com\n\n# Check SSL certificate\nopenssl s_client -connect your-domain.com:443\n```\n\n### Performance Monitoring\n\n```bash\n# Monitor application performance\nnpm install --save-dev clinic\nnpx clinic doctor -- npm start\n\n# Monitor bundle size\nnpm install --save-dev bundlesize\n# Add to package.json:\n# \"bundlesize\": [{\n#   \"path\": \".next/static/chunks/*.js\",\n#   \"maxSize\": \"250kb\"\n# }]\n```\n\n## Deployment Checklist\n\n### Pre-Deployment\n\n- [ ] Environment variables configured\n- [ ] Build process tested locally\n- [ ] All tests passing\n- [ ] Security headers configured\n- [ ] SSL certificate ready\n- [ ] Domain DNS configured\n- [ ] Monitoring setup\n\n### Post-Deployment\n\n- [ ] Health check endpoint responding\n- [ ] All pages loading correctly\n- [ ] API endpoints functional\n- [ ] SSL certificate valid\n- [ ] Performance metrics acceptable\n- [ ] Error monitoring active\n- [ ] Backup procedures in place\n\n### Rollback Plan\n\n- [ ] Previous version tagged in Git\n- [ ] Database backup (if applicable)\n- [ ] Rollback procedure documented\n- [ ] Monitoring alerts configured\n- [ ] Team notification process\n\n---\n\n## Support\n\nFor deployment support:\n\n- **Documentation**: Check this guide and troubleshooting section\n- **Issues**: Report deployment issues on GitHub\n- **Community**: Join discussions for deployment questions\n- **Professional Support**: Contact for enterprise deployment assistance\n\n---\n\n**Last Updated**: January 2024  \n**Deployment Guide Version**: 1.0  \n**Next Review**: March 2024